var days_ref=["Sun","Mon","Tues","Weds","Thurs","Fri","Sat"],kelvin_to_f=function(t){return(1.8*(t-273.15)+32).toFixed(2)},unixCode_to_weekDay=function(t){return days_ref[new Date(1e3*t).getDay()]},formatChart=function(t){d3.json("http://api.openweathermap.org/data/2.5/forecast/daily?q="+t,function(t){var e=[],n=[];if(console.log(t),t&&"404"!==t.cod){t.list.forEach(function(t){var a=kelvin_to_f(t.temp.day),l=unixCode_to_weekDay(t.dt);e.push(a),n.push(l)});var a,l={top:30,right:30,bottom:40,left:50},o=400-l.top-l.bottom,r=600-l.left-l.right,i=d3.scale.linear().domain([0,.33*e.length,.66*e.length,e.length]).range(["#B58929","#C61C6F","#268BD2","#85992C"]),s=d3.scale.linear().domain([d3.min(e)-10,d3.max(e)+10]).range([0,o]),d=d3.scale.ordinal().domain(d3.range(0,e.length)).rangeBands([0,r],.2),c=d3.select("body").append("div").style("position","absolute").style("padding","0 10px").style("background","white").style("opacity",0),p=d3.select("#chart").append("svg").style("background","#E7E0CB").attr("width",r+l.left+l.right).attr("height",o+l.top+l.bottom).append("g").attr("transform","translate("+l.left+", "+l.top+")").selectAll("rect").data(e).enter().append("rect").style("fill",function(t,e){return i(e)}).attr("width",d.rangeBand()).attr("x",function(t,e){return d(e)}).attr("height",0).attr("y",o).on("mouseover",function(t){c.transition().style("opacity",.9),c.html(t).style("left",d3.event.pageX-35+"px").style("top",d3.event.pageY-30+"px"),a=this.style.fill,d3.select(this).style("opacity",.5).style("fill","yellow")}).on("mouseout",function(t){d3.select(this).style("opacity",1).style("fill",a)}),u=d3.scale.linear().domain([d3.min(e)-10,d3.max(e)+10]).range([o,0]),f=d3.scale.ordinal().domain(n).rangeBands([0,r],.2),y=d3.svg.axis().scale(u).orient("left").ticks(10),g=d3.svg.axis().scale(f).orient("bottom").tickValues(f.domain()),h=d3.select("svg").append("g"),m=d3.select("svg").append("g");g(m),m.attr("transform","translate("+l.left+", "+(o+l.top)+")"),m.selectAll("path").style({fill:"none",stroke:"#000"}),m.selectAll("line").style({stroke:"#000"}),y(h),h.attr("transform","translate("+l.left+", "+l.top+")"),h.selectAll("path").style({fill:"none",stroke:"#000"}),h.selectAll("line").style({stroke:"#000"}),p.transition().attr("height",function(t){return s(t)}).attr("y",function(t){return o-s(t)}).delay(function(t,e){return 20*e}).duration(1e3).ease("elastic")}})};document.getElementById("city-input").addEventListener("input",function(t){document.getElementById("chart").innerHTML="",formatChart(this.value)});