var barData=[],axisDays=[],days_ref=["Sun","Mon","Tues","Weds","Thurs","Fri","Sat"],kelvin_to_f=function(t){return(1.8*(t-273.15)+32).toFixed(2)},unixCode_to_weekDay=function(t){return days_ref[new Date(1e3*t).getDay()]};d3.json("http://api.openweathermap.org/data/2.5/forecast/daily?q=Springfield,MO",function(t){t.list.forEach(function(t){var e=kelvin_to_f(t.temp.day),a=unixCode_to_weekDay(t.dt);barData.push(e),axisDays.push(a)});var e,a={top:30,right:30,bottom:40,left:50},n=400-a.top-a.bottom,l=600-a.left-a.right,r=d3.scale.linear().domain([0,.33*barData.length,.66*barData.length,barData.length]).range(["#B58929","#C61C6F","#268BD2","#85992C"]),s=d3.scale.linear().domain([d3.min(barData)-10,d3.max(barData)+10]).range([0,n]),i=d3.scale.ordinal().domain(d3.range(0,barData.length)).rangeBands([0,l],.2),o=d3.select("body").append("div").style("position","absolute").style("padding","0 10px").style("background","white").style("opacity",0),d=d3.select("#chart").append("svg").style("background","#E7E0CB").attr("width",l+a.left+a.right).attr("height",n+a.top+a.bottom).append("g").attr("transform","translate("+a.left+", "+a.top+")").selectAll("rect").data(barData).enter().append("rect").style("fill",function(t,e){return r(e)}).attr("width",i.rangeBand()).attr("x",function(t,e){return i(e)}).attr("height",0).attr("y",n).on("mouseover",function(t){o.transition().style("opacity",.9),o.html(t).style("left",d3.event.pageX-35+"px").style("top",d3.event.pageY-30+"px"),e=this.style.fill,d3.select(this).style("opacity",.5).style("fill","yellow")}).on("mouseout",function(t){d3.select(this).style("opacity",1).style("fill",e)}),c=d3.scale.linear().domain([d3.min(barData)-10,d3.max(barData)+10]).range([n,0]),p=d3.scale.ordinal().domain(axisDays).rangeBands([0,l],.2),y=d3.svg.axis().scale(c).orient("left").ticks(10),f=d3.svg.axis().scale(p).orient("bottom").tickValues(p.domain()),g=d3.select("svg").append("g"),u=d3.select("svg").append("g");f(u),u.attr("transform","translate("+a.left+", "+(n+a.top)+")"),u.selectAll("path").style({fill:"none",stroke:"#000"}),u.selectAll("line").style({stroke:"#000"}),y(g),g.attr("transform","translate("+a.left+", "+a.top+")"),g.selectAll("path").style({fill:"none",stroke:"#000"}),g.selectAll("line").style({stroke:"#000"}),d.transition().attr("height",function(t){return s(t)}).attr("y",function(t){return n-s(t)}).delay(function(t,e){return 20*e}).duration(1e3).ease("elastic")});