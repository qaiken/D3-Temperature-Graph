var tempGraph=function(t,e,n,r){var a,i,o=["Sun","Mon","Tues","Weds","Thurs","Fri","Sat"],l=function(t){return(1.8*(t-273.15)+32).toFixed(2)},s=function(t){return o[new Date(1e3*t).getDay()]},e=e-n.top-n.bottom,t=t-n.left-n.right;return{submitting:!1,formatChart:function(o){d3.json("http://api.openweathermap.org/data/2.5/forecast/daily?q="+o,function(c){var u=[],d=[],p=[],f=[];if(c&&"404"!==c.cod){a=c.list.length,o=c.city.name+", "+c.city.country,c.list.forEach(function(t,e){var n=l(t.temp.day),r=s(t.dt),i={temp:n};u.push(n),d.push(r),e!==a-1&&(i.target=e+1),p.push(i)}),p.forEach(function(t){t.hasOwnProperty("target")&&f.push({source:t,target:p[t.target]})});var m=d3.scale.linear().domain([0,.33*u.length,.66*u.length,u.length]).range(["#B58929","#C61C6F","#268BD2","#85992C"]),y=d3.scale.linear().domain([d3.min(u)-5,d3.max(u)+5]).range([0,e]),g=d3.scale.ordinal().domain(d3.range(0,u.length)).rangeBands([0,t],.2),h=d3.select("body").append("div").attr("id","tool-tip"),x=d3.select("#chart").append("svg"),v=x.style("background","#E7E0CB").attr("width",t+n.left+n.right).attr("height",e+n.top+n.bottom).append("g").attr("transform","translate("+n.left+", "+n.top+")"),b=d3.scale.linear().domain([d3.min(u)-5,d3.max(u)+5]).range([e,0]),k=d3.scale.ordinal().domain(d).rangeBands([0,t],.2),B=d3.svg.axis().scale(b).orient("left").ticks(10),E=d3.svg.axis().scale(k).orient("bottom").tickValues(k.domain()),A=d3.select("svg").append("g"),C=d3.select("svg").append("g");p.forEach(function(t,n){t.x=g(n)+g.rangeBand()/2,t.y=e-y(t.temp)}),v.selectAll("line").data(f).enter().append("line").attr("stroke",function(t,e){return m(e)}).attr("x1",function(t){return t.source.x}).attr("y1",function(t){return t.source.y}).attr("x2",function(t){return t.source.x}).attr("y2",function(t){return t.source.y}).transition().attr("x2",function(t){return t.target.x}).attr("y2",function(t){return t.target.y}).delay(function(t,e){return 200*e}).ease("linear"),v.selectAll("circle").data(p).enter().append("circle").attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}).attr("fill",function(t,e){return m(e)}).on("mouseover",function(t){h.transition().style("opacity",.9),h.html(t.temp+"&deg;F").style("left",d3.event.pageX-35+"px").style("top",d3.event.pageY-35+"px"),i=this.style.fill,d3.select(this).transition().style("opacity",.5).style("fill","yellow")}).on("mouseout",function(t){d3.select(this).transition().style("opacity",1).style("fill",i),h.transition().style("opacity",0)}).transition().attr("r",r).delay(function(t,e){return 200*e}).ease("elastic"),E(C),C.attr("transform","translate("+n.left+", "+(e+n.top)+")"),C.selectAll("path").style({fill:"none",stroke:"#000"}),C.selectAll("line").style({stroke:"#000"}),B(A),A.attr("transform","translate("+n.left+", "+n.top+")"),A.selectAll("path").style({fill:"none",stroke:"#000"}),A.selectAll("line").style({stroke:"#000"}),x.append("text").attr("x",t/2).attr("y",n.top/2).attr("text-anchor","middle").style("font-size","16px").style("text-decoration","underline").text("Temperatures for "+o)}})}}}(600,400,{top:40,right:30,bottom:40,left:50},10);document.getElementById("city-input").addEventListener("input",function(t){var e=function(){tempGraph.submitting=!1,document.getElementById("chart").innerHTML="",tempGraph.formatChart(this.value)};tempGraph.submitting||(tempGraph.submitting=!0,setTimeout(e.bind(t.target),500))});